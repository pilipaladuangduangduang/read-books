# 04.Java内存模型

标签（空格分隔）：实战Java高并发程序设计

---

Java内存模型（JMM）的关键技术点都是围绕着多线程的原子性、可见性和有序性来建立的，理解这些概念极其重要。

## 原子性（Atomic）

原子性是指一个操作是连续性的、不可中断的。

## 可见性（Visibility）

可见性是指一个线程修改了某个共享数据的值，其它线程能否立即知道这个修改。

可见性问题是一个综合性问题，常常会因为CPU缓存优化、编译器优化、硬件上的优化或是指令重拍而发生。

## 有序性（Order）

因为存在指令重排，所以多线程之间不能保证有效，单线程内部是可以保证顺序的。

## 指令重排

...

## 哪些指令不能重排：Happen-Before原则

JVM虚拟机和执行系统会对指令进行一定的重排，但是重排是有原则的，并非所有的指令都可以重排，如下：

 - 单线程内部是不允许重排的；

 - volatile关键字，volatile变量的写，先发生于读，这就保证了volatile变量的可见性；

 - 线程的start()方法一定是最先的；

 - 线程的所有操作先于Thread.join()；

 - 对象的构造器执行、结束先于finalize()方法。